<div class="collection-page">
  <div class="container section-padding">
    <!-- Collection Header -->
    <div class="collection-header">
      <h1 class="collection-title">{{ collection.title }}</h1>
      {% if collection.description != blank %}
        <div class="collection-description">
          {{ collection.description }}
        </div>
      {% endif %}
      <p class="collection-count">{{ collection.products_count }} products</p>
    </div>

    <!-- Filters and Sort -->
    <div class="collection-toolbar">
      <div class="collection-filters">
        <button class="filter-toggle" id="filterToggle">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="4" y1="21" x2="4" y2="14"></line>
            <line x1="4" y1="10" x2="4" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12" y2="3"></line>
            <line x1="20" y1="21" x2="20" y2="16"></line>
            <line x1="20" y1="12" x2="20" y2="3"></line>
            <line x1="1" y1="14" x2="7" y2="14"></line>
            <line x1="9" y1="8" x2="15" y2="8"></line>
            <line x1="17" y1="16" x2="23" y2="16"></line>
          </svg>
          Filters
        </button>
      </div>

      <div class="collection-sort">
        <label for="sortBy">Sort by:</label>
        <select id="sortBy" class="sort-select">
          <option value="manual">Featured</option>
          <option value="best-selling">Best Selling</option>
          <option value="title-ascending">Alphabetically, A-Z</option>
          <option value="title-descending">Alphabetically, Z-A</option>
          <option value="price-ascending">Price, Low to High</option>
          <option value="price-descending">Price, High to Low</option>
          <option value="created-ascending">Date, Old to New</option>
          <option value="created-descending">Date, New to Old</option>
        </select>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="collection-products">
      {% paginate collection.products by 12 %}
        <div class="products-grid">
          {% for product in collection.products %}
            {% render 'product-card', product: product %}
          {% endfor %}
        </div>

        {% if paginate.pages > 1 %}
          <div class="pagination">
            {% if paginate.previous %}
              <a href="{{ paginate.previous.url }}" class="pagination-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Previous
              </a>
            {% endif %}

            <span class="pagination-info">
              Page {{ paginate.current_page }} of {{ paginate.pages }}
            </span>

            {% if paginate.next %}
              <a href="{{ paginate.next.url }}" class="pagination-btn">
                Next
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endpaginate %}
    </div>
  </div>
</div>

<style>
  .collection-page {
    min-height: 60vh;
  }

  .collection-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .collection-title {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .collection-description {
    max-width: 700px;
    margin: 0 auto 1rem;
    line-height: 1.8;
    opacity: 0.8;
  }

  .collection-count {
    font-size: 0.95rem;
    opacity: 0.6;
  }

  .collection-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1rem;
    background-color: rgba(139, 115, 85, 0.05);
    border-radius: 8px;
  }

  .filter-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background-color: var(--color-bg);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  [data-theme="dark"] .filter-toggle {
    border-color: rgba(255, 255, 255, 0.1);
  }

  .filter-toggle:hover {
    border-color: var(--color-accent);
  }

  .collection-sort {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .collection-sort label {
    font-weight: 500;
  }

  .sort-select {
    padding: 0.75rem 1rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    background-color: var(--color-bg);
    color: var(--color-text);
    font-size: 0.95rem;
    cursor: pointer;
  }

  [data-theme="dark"] .sort-select {
    border-color: rgba(255, 255, 255, 0.1);
  }

  .collection-products {
    margin-top: 2rem;
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    margin-top: 3rem;
  }

  .pagination-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background-color: var(--color-bg);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  [data-theme="dark"] .pagination-btn {
    border-color: rgba(255, 255, 255, 0.1);
  }

  .pagination-btn:hover {
    background-color: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .pagination-info {
    font-weight: 500;
    opacity: 0.7;
  }

  @media (max-width: 768px) {
    .collection-title {
      font-size: 2rem;
    }

    .collection-toolbar {
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }

    .collection-sort {
      flex-direction: column;
      align-items: stretch;
    }

    .sort-select {
      width: 100%;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .pagination {
      flex-direction: column;
      gap: 1rem;
    }

    .pagination-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  // Sort functionality
  const sortSelect = document.getElementById('sortBy');
  
  if (sortSelect) {
    sortSelect.addEventListener('change', (e) => {
      const sortValue = e.target.value;
      const url = new URL(window.location.href);
      url.searchParams.set('sort_by', sortValue);
      window.location.href = url.toString();
    });

    // Set current sort value from URL
    const urlParams = new URLSearchParams(window.location.search);
    const currentSort = urlParams.get('sort_by');
    if (currentSort) {
      sortSelect.value = currentSort;
    }
  }
</script>